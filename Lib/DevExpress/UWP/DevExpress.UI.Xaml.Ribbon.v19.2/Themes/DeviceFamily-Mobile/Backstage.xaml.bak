<ResourceDictionary
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:Ribbon="using:DevExpress.UI.Xaml.Ribbon"
    xmlns:Xaml="using:DevExpress.UI.Xaml"
    xmlns:Core="using:DevExpress.Core"
    xmlns:Internal="using:DevExpress.UI.Xaml.Ribbon.Internal"
    xmlns:XamlInternal="using:DevExpress.UI.Xaml.Internal"
    xmlns:Interactivity="using:DevExpress.Mvvm.UI.Interactivity"
    xmlns:Controls="using:DevExpress.UI.Xaml.Controls">

    <ResourceDictionary.MergedDictionaries>
        <ResourceDictionary Source="ms-appx:///DevExpress.UI.Xaml.Ribbon.v19.2/Themes/Backstage.Colors.xaml"/>
    </ResourceDictionary.MergedDictionaries>
    
    <Internal:ThicknessNegationConverter x:Key="ThicknessNegationConverter"/>
    <Core:ObjectToBooleanConverter x:Key="ObjectToBooleanConverter"/>
    
    <Style TargetType="Ribbon:BackstageView">
        <Setter Property="Background" Value="{ThemeResource RibbonBackstageMobileBackgroundBrush}"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Ribbon:BackstageView">
                    <Grid Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          VerticalAlignment="Stretch"
                          HorizontalAlignment="Stretch">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition/>
                        </Grid.RowDefinitions>
                        <Border Background="{ThemeResource RibbonBackstageMobileTabsBackgroundBrush}" 
                                Grid.RowSpan="2"/>
                        <ItemsControl x:Name="PART_ItemsControl"
                                      ItemsSource="{Binding Items, RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                      Grid.Row="1"/>
                        <Ribbon:BackstageButtonItem x:Name="PART_CloseButton" 
                                                    IconSource="&#xE700;"
                                                    IconFill="{ThemeResource RibbonBackstageMobileButtonIconFillBrush}"
                                                    Command="{Binding CloseCommand, RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                                    IconWidth="24"
                                                    IconHeight="24"
                                                    Padding="6,38,0,6"
                                                    HorizontalAlignment="Stretch"/>
                        <Border Grid.Column="1"
                                Grid.RowSpan="2"
                                VerticalAlignment="Stretch"
                                HorizontalAlignment="Stretch"
                                Background="Transparent">
                            <Interactivity:Interaction.BehaviorsTemplate>
                                <DataTemplate>
                                    <ContentControl>
                                        <Internal:CloseParentPopupOnAreaClickBehavior/>
                                    </ContentControl>   
                                </DataTemplate>
                            </Interactivity:Interaction.BehaviorsTemplate>
                        </Border>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
    <Style TargetType="Ribbon:BackstageTabItem">
        <Setter Property="UseSystemFocusVisuals" Value="False"/>
        <Setter Property="Padding" Value="14,18,28,18"/>
        <Setter Property="FontSize" Value="20"/>
        <Setter Property="HorizontalContentAlignment" Value="Left"/>
        <Setter Property="Foreground" Value="{ThemeResource BackstageTabItemMobileForegroundBrush}"/>
        <Setter Property="Background" Value="{ThemeResource BackstageTabItemMobileBackgroundBrush}"/>
        <Setter Property="ClosePopupOnClick" Value="True"/>
        <Setter Property="ControlPaneShowMode" Value="Flyout"/>
        <Setter Property="Template">
            <Setter.Value>
                <ControlTemplate TargetType="Ribbon:BackstageTabItem">
                    <Grid x:Name="PART_Background"
                          Background="{TemplateBinding Background}"
                          BorderBrush="{TemplateBinding BorderBrush}"
                          BorderThickness="{TemplateBinding BorderThickness}"
                          Padding="{TemplateBinding Padding}">
                        <VisualStateManager.VisualStateGroups>
                            <VisualStateGroup x:Name="CommonStates">
                                <VisualState x:Name="Normal"/>
                                <VisualState x:Name="Disabled">
                                    <VisualState.Setters>
                                        <Setter Target="PART_Background.Opacity" Value="0.4"/>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="SelectionStates">
                                <VisualState x:Name="Unselected"/>
                                <VisualState x:Name="UnselectedPointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="PART_Background.Background" Value="{ThemeResource BackstageTabItemMobileBackgroundHoverBrush}"/>
                                        <Setter Target="PART_Icon.Foreground" Value="{ThemeResource BackstageTabItemMobileIconForegroundHoverBrush}"/>
                                        <Setter Target="PART_Text.Foreground" Value="{ThemeResource BackstageTabItemMobileForegroundHoverBrush}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="UnselectedPressed">
                                    <VisualState.Setters>
                                        <Setter Target="PART_Background.Background" Value="{ThemeResource BackstageTabItemMobileBackgroundPressedBrush}"/>
                                        <Setter Target="PART_Icon.Foreground" Value="{ThemeResource BackstageTabItemMobileIconForegroundPressedBrush}"/>
                                        <Setter Target="PART_Text.Foreground" Value="{ThemeResource BackstageTabItemMobileForegroundPressedBrush}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Selected">
                                    <VisualState.Setters>
                                        <Setter Target="PART_Background.Background" Value="{ThemeResource BackstageTabItemMobileBackgroundSelectedBrush}"/>
                                        <Setter Target="PART_Icon.Foreground" Value="{ThemeResource BackstageTabItemMobileIconForegroundSelectedBrush}"/>
                                        <Setter Target="PART_Text.Foreground" Value="{ThemeResource BackstageTabItemMobileForegroundSelectedBrush}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="SelectedPointerOver">
                                    <VisualState.Setters>
                                        <Setter Target="PART_Background.Background" Value="{ThemeResource BackstageTabItemMobileBackgroundSelectedHoverBrush}"/>
                                        <Setter Target="PART_Icon.Foreground" Value="{ThemeResource BackstageTabItemMobileIconForegroundSelectedHoverBrush}"/>
                                        <Setter Target="PART_Text.Foreground" Value="{ThemeResource BackstageTabItemMobileForegroundSelectedHoverBrush}"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="SelectedPressed">
                                    <VisualState.Setters>
                                        <Setter Target="PART_Background.Background" Value="{ThemeResource BackstageTabItemMobileBackgroundSelectedPressedBrush}"/>
                                        <Setter Target="PART_Icon.Foreground" Value="{ThemeResource BackstageTabItemMobileIconForegroundSelectedPressedBrush}"/>
                                        <Setter Target="PART_Text.Foreground" Value="{ThemeResource BackstageTabItemMobileForegroundSelectedPressedBrush}"/>
                                    </VisualState.Setters>
                                </VisualState>
                            </VisualStateGroup>
                            <VisualStateGroup x:Name="FocusStates">
                                <VisualState x:Name="Focused">
                                    <VisualState.Setters>
                                        <Setter Target="PART_FocusVisual.Opacity" Value="0.9"/>
                                    </VisualState.Setters>
                                </VisualState>
                                <VisualState x:Name="Unfocused" />
                                <VisualState x:Name="PointerFocused" />
                            </VisualStateGroup>
                        </VisualStateManager.VisualStateGroups>

                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition/>
                        </Grid.ColumnDefinitions>
                        <Border x:Name="PART_FocusVisual"
                                Margin="{Binding Padding, RelativeSource={RelativeSource Mode=TemplatedParent}, Converter={StaticResource ThicknessNegationConverter}}"
                                Grid.ColumnSpan="2"
                                x:DeferLoadStrategy="Lazy"
                                IsHitTestVisible="False"
                                BorderThickness="0"
                                Opacity="0"
                                BorderBrush="{ThemeResource BackstageTabItemMobileFocusVisualStrokeBrush}"
                                Background="{ThemeResource BackstageTabItemMobileFocusVisualBackgroundBrush}"/>
                        <XamlInternal:NestedMenuFlyoutControl x:Name="PART_Flyout"
                                                       x:DeferLoadStrategy="Lazy"
                                                       HeaderEnabledMode="Auto"
                                                       BackButtonEnabledMode="Auto"
                                                       VerticalContentAlignment="Stretch"
                                                       HorizontalContentAlignment="Stretch"
                                                       VerticalAlignment="Stretch"
                                                       HorizontalAlignment="Stretch"
                                                       Content="{TemplateBinding ControlPane}"/>
                        <XamlInternal:IconView x:Name="PART_Icon"
                                            Foreground="{TemplateBinding Foreground}"
                                            Owner="{Binding RelativeSource={RelativeSource Mode=TemplatedParent}}"
                                            UseIconPadding="{Binding Content, RelativeSource={RelativeSource Mode=TemplatedParent}, Converter={StaticResource ObjectToBooleanConverter}}"/>
                        <ContentPresenter x:Name="PART_Text"
                                            Grid.Column="1"
                                            VerticalAlignment="Center" 
                                            HorizontalAlignment="{TemplateBinding HorizontalContentAlignment}"
                                            Foreground="{TemplateBinding Foreground}"
                                            Content="{TemplateBinding Content}"/>
                        <!--for binding purposes-->
                        <ContentControl Content="{TemplateBinding ControlPane}"
                                        VerticalContentAlignment="Center"
                                        HorizontalContentAlignment="Center">
                            <ContentControl.Template>
                                <ControlTemplate>
                                    <Rectangle/>
                                </ControlTemplate>
                            </ContentControl.Template>
                        </ContentControl>
                    </Grid>
                </ControlTemplate>
            </Setter.Value>
        </Setter>
    </Style>
</ResourceDictionary>
